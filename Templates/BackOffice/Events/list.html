<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <link rel="stylesheet" href="{% static 'backOffice/assets/css/theme.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <title>List of Events | Dash Ui - Bootstrap 5 Admin Dashboard Template</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
        }
        .bg-primary {
            background-color: #007bff !important;
        }

        h1 {
            color: white !important;
            margin-bottom: 20px;
        }

        .table {
            width: 100%;
            margin-bottom: 1rem;
            border-collapse: collapse;
            background-color: #f8f9fa; /* Light background for the table */
        }

        .table th {
            background-color: #6f42c1; /* Purple header */
            color: white;
            padding: 10px 15px;
            text-align: center;
        }

        .table td {
            padding: 10px;
            text-align: left;
            border: 1px solid #dee2e6; /* Light border */
            font-size: 14px;
            background-color: white; /* White background for cells */
            transition: background-color 0.3s;
        }

        .table tr:hover td {
            background-color: #e2e3e5; /* Light gray on hover */
        }

        .btn {
            border-radius: 5px; /* Rounded buttons */
        }

        .btn-success {
            background-color: #28a745; /* Green */
            border-color: #28a745;
        }

        .btn-warning {
            background-color: #ffc107; /* Yellow */
            border-color: #ffc107;
        }

        .btn-danger {
            background-color: #dc3545; /* Red */
            border-color: #dc3545;
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            table, thead, tbody, th, td, tr {
                display: block;
                width: 100%;
            }
            th, td {
                box-sizing: border-box;
                padding: 10px;
                text-align: right;
                border: none;
            }
            td {
                text-align: left;
                position: relative;
                padding-left: 50%;
            }
            td::before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: calc(50% - 20px);
                white-space: nowrap;
                text-align: left;
            }
        }
    </style>
</head>

<body class="bg-light">
    <div id="db-wrapper">
        {% include 'BackOffice/partials/navbar-vertical.html' with page="dashboard" %}
        <div id="page-content">
            {% include 'BackOffice/partials/header.html' %}
            <div class="bg-primary pt-10 pb-21"></div>
            <div class="container-fluid mt-n22 px-6">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <h1>List of Events</h1>
                            <a href="{% url 'Event:add_event' %}" class="btn btn-success">Add Event</a>
                        </div>
                    </div>
                    <div class="mt-4"></div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="col-md-6">
                            <form method="GET" action="{% url 'Event:event_list' %}" class="d-flex">
                                <div class="input-group me-2">
                                    <input type="text" name="q" class="form-control" placeholder="Search events" value="{{ request.GET.q }}">
                                    <button type="submit" class="btn btn-primary">Search</button>
                                </div>
                                <div class="input-group">
                                    <label class="input-group-text" for="sort">Sort by</label>
                                    <select class="form-select" name="sort" id="sort" onchange="this.form.submit()">
                                        <option value="start_date" {% if sort_by == 'start_date' %}selected{% endif %}>Start Date</option>
                                        <option value="end_date" {% if sort_by == 'end_date' %}selected{% endif %}>End Date</option>
                                        <option value="price_per_place" {% if sort_by == 'price_per_place' %}selected{% endif %}>Price Per Place</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div>
                        <a href="{% url 'Event:download_pdf' %}" class="btn btn-primary">Download PDF</a>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Event Title</th>
                                    <th>City</th>
                                    <th>Location</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Price Per Place</th>
                                    <th>Available Places</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for event in events %}
                                <tr>
                                    <td data-label="Image">
                                        {% if event.image %}
                                        <img src="{{ event.image.url }}" alt="{{ event.title }}" style="width: 100px; height: 100px;">
                                        {% else %}
                                        No Image
                                        {% endif %}
                                    </td>
                                    <td data-label="Event Title">{{ event.title }}</td>
                                    <td data-label="City">{{ event.city }}</td>
                                    <td data-label="Location">{{ event.location }}</td>
                                    <td data-label="Start Date">{{ event.start_date }}</td>
                                    <td data-label="End Date">{{ event.end_date }}</td>
                                    <td data-label="Price Per Place">{{ event.price_per_place }} DT</td>
                                    <td data-label="Available Places">{{ event.number_places }}</td>
                                    <td data-label="Actions">
                                        <a href="{% url 'Event:edit_event' event.id %}" class="btn btn-warning btn-sm">Edit</a>
                                        <a href="{% url 'Event:delete_event' event.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this event?');">Delete</a>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="9" class="text-center">No events found.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination-container mt-4">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                {% if is_paginated %}
                                    {% if page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page=1&q={{ request.GET.q }}&sort={{ request.GET.sort }}" aria-label="First">&laquo;&laquo;</a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ request.GET.q }}&sort={{ request.GET.sort }}" aria-label="Previous">&laquo;</a>
                                        </li>
                                    {% endif %}
                                    {% for num in page_obj.paginator.page_range %}
                                        <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                                            <a class="page-link" href="?page={{ num }}&q={{ request.GET.q }}&sort={{ request.GET.sort }}">{{ num }}</a>
                                        </li>
                                    {% endfor %}
                                    {% if page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ request.GET.q }}&sort={{ request.GET.sort }}" aria-label="Next">&raquo;</a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}&q={{ request.GET.q }}&sort={{ request.GET.sort }}" aria-label="Last">&laquo;&laquo;</a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static 'backOffice/assets/js/bootstrap.bundle.min.js' %}"></script>
</body>
</html>
